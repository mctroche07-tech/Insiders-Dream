<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TradePilot — Dashboard</title>
  <meta name="description" content="Statistics · Calendar · Journal · Extras — single-file dashboard for GitHub Pages" />
  <style>
    :root{ --bg:#0b0f19; --bg2:#0e1422; --card:#121a2b; --text:#e6eaf2; --muted:#96a0b5; --primary:#6aa6ff; --primary-2:#397dff; --border:#1f2a44; --accent:#3ddc97; --shadow:0 10px 30px rgba(0,0,0,.35)}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0; font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial; color:var(--text); background:radial-gradient(1200px 700px at 10% -10%, rgba(106,166,255,.12), transparent 60%), radial-gradient(1000px 700px at 95% 0%, rgba(61,220,151,.10), transparent 60%), var(--bg)}
    a{color:var(--primary)} .container{max-width:1200px; margin:0 auto; padding:0 20px}
    header{position:sticky; top:0; z-index:40; backdrop-filter:saturate(160%) blur(12px); background:rgba(11,15,25,.6); border-bottom:1px solid var(--border)}
    .nav{display:flex; align-items:center; justify-content:space-between; height:64px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:800}
    .logo{width:28px; height:28px; border-radius:8px; background:linear-gradient(135deg, var(--primary), var(--accent)); box-shadow:var(--shadow)}
    .tabs{display:flex; align-items:center; gap:8px; background:var(--bg2); border:1px solid var(--border); border-radius:12px; padding:6px}
    .tab{appearance:none; background:transparent; border:0; color:#cbd5e1; padding:8px 12px; border-radius:10px; font-weight:700; cursor:pointer}
    .tab.active{background:linear-gradient(135deg, var(--primary), var(--primary-2)); color:#fff}
    main{padding:24px 0}
    .grid{display:grid; gap:16px} .g-2{grid-template-columns:1fr 1fr} .g-3{grid-template-columns:repeat(3,1fr)} .g-split{grid-template-columns:0.9fr 1.1fr}
    .card{background:var(--card); border:1px solid var(--border); border-radius:16px; box-shadow:var(--shadow)}
    .card-h{padding:14px 16px; border-bottom:1px solid var(--border); font-weight:800}
    .card-c{padding:16px}
    label{display:block; font-size:12px; color:var(--muted); margin-bottom:4px}
    input, select, textarea, button{font:inherit}
    .inp, .sel, .btn, textarea{width:100%; background:var(--bg2); color:var(--text); border:1px solid var(--border); border-radius:12px; padding:10px 12px}
    .btn.primary{background:linear-gradient(135deg, var(--primary), var(--primary-2)); color:#fff; border:0}
    .row{display:flex; flex-wrap:wrap; gap:12px; align-items:flex-end}
    .col{min-width:160px}
    .badge{display:inline-flex; align-items:center; gap:6px; font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid var(--border); background:var(--bg2); color:var(--muted)}
    .muted{color:var(--muted)} .green{color:#34d399} .red{color:#f87171}
    /* Calendar grid */
    .ff-grid{display:grid; grid-template-columns: repeat(7, 1fr); gap:10px}
    .ff-day{border:1px solid var(--border); border-radius:12px; background:var(--bg2); padding:10px; min-height:140px; display:flex; flex-direction:column}
    .ff-day h4{margin:0 0 8px 0; font-size:12px; color:#cbd5e1; font-weight:700}
    .ff-ev{display:flex; align-items:center; gap:6px; font-size:12px; padding:4px 6px; border-radius:8px; margin:3px 0; background:var(--card); border:1px solid var(--border)}
    .dot{width:8px; height:8px; border-radius:999px}
    .dot.high{background:#f87171} .dot.medium{background:#fbbf24} .dot.low{background:#60a5fa}
    table{width:100%; border-collapse:collapse} th,td{padding:10px 8px; border-bottom:1px solid #0f172a} th{font-weight:700; color:#cbd5e1; text-align:left} td.right{text-align:right}
    @media (max-width:980px){ .g-3,.g-split,.g-2{grid-template-columns:1fr} .tabs{overflow:auto} .ff-grid{grid-template-columns:1fr 1fr} }
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand"><span class="logo"></span> TradePilot</div>
      <div class="tabs" role="tablist" aria-label="Primary">
        <button class="tab active" data-tab="stats">Statistics</button>
        <button class="tab" data-tab="calendar">News / Calendar</button>
        <button class="tab" data-tab="journal">Journal</button>
        <button class="tab" data-tab="extras">Extras</button>
      </div>
      <div style="width:28px"></div>
    </div>
  </header>

  <main class="container">
    <!-- ================== STATISTICS ================== -->
    <section id="stats" class="tabpane">
      <div class="grid g-split">
        <div>
          
          </div>
        </div>

        <div>
          <div class="card">
            <div class="card-h">Controls</div>
            <div class="card-c">
              <div class="row">
                <div class="col" style="flex:1">
                  <label>Strategy</label>
                  <select id="strat" class="sel"></select>
                </div>
                <div class="col">
                  <label>Symbol</label>
                  <select id="sym" class="sel">
                    <option value="NQ">NQ (Nasdaq)</option>
                    <option value="ES">ES (S&P)</option>
                    <option value="GOLD">Gold</option>
                    <option value="EURUSD">EURUSD</option>
                    <option value="GBPUSD">GBPUSD</option>
                    <option value="USDJPY">USDJPY</option>
                  </select>
                </div></div>
              <div class="row" style="margin-top:8px">
                <div class="col">
                  <label>Quick Range</label>
                  <div class="row" style="gap:6px">
                    <button class="btn" data-range="1m">1m</button>
                    <button class="btn" data-range="3m">3m</button>
                    <button class="btn" data-range="6m">6m</button>
                    <button class="btn" data-range="1y">1y</button>
                    <button class="btn" data-range="all">All</button>
                  </div>
                </div>
                <div class="col"><label>From</label><input id="from" type="date" class="inp" value="2024-01-01" /></div>
                <div class="col"><label>To</label><input id="to" type="date" class="inp" /></div>
                <div class="col"><label>Trades (sample)</label><input id="trades" type="number" class="inp" min="20" max="2000" value="200" /></div>
                <div class="col"><label>Risk % / trade</label><input id="risk" type="number" class="inp" min="0.1" step="0.1" value="1" /></div>
              </div>
              <div class="row" style="margin-top:8px"><button id="run" class="btn primary">Run (mock)</button></div>
            </div>
          </div>

          <div class="grid g-3">
            <div class="card"><div class="card-h">Win Rate</div><div class="card-c"><div id="winrate" style="font-size:32px; font-weight:800">—</div></div></div>
            <div class="card"><div class="card-h">Expectancy</div><div class="card-c"><div id="expect" style="font-size:32px; font-weight:800">—</div></div></div>
            <div class="card"><div class="card-h">Equity Curve (mock)</div><div class="card-c"><canvas id="eq" height="120"></canvas></div></div>
          </div>
          <div class="card" style="margin-top:12px"><div class="card-h">Notes</div><div class="card-c muted">Starter wiring. Replace mocks with your backtest/DB when ready. Quick ranges: [1m, 3m, 6m, 1y, all]. Symbols: NQ, ES, Gold, major FX.</div></div>
        </div>
      </div>

      <!-- Full-width Strategy Visual under Notes -->
      <div class="card" id="stratVisualCard" style="margin-top:12px">
        <div class="card-h">Strategy Visual</div>
        <div class="card-c">
          <div class="muted" style="margin-bottom:8px">Illustrative mock — replace with a real chart snapshot when ready.</div>
          <div class="rounded-xl" style="border:1px solid var(--border); background:var(--bg2); padding:0; overflow:hidden">
            <svg id="stratSvg" viewBox="0 0 600 260" style="width:100%; height:360px; transform: scale(1.35); transform-origin: center"></svg>
          </div>
          <div style="margin-top:8px; display:flex; gap:8px; align-items:center; flex-wrap:wrap">
            <div id="stratName" style="font-weight:700"></div>
            <div id="stratDesc" class="muted" style="font-size:14px"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- ================== CALENDAR / NEWS ================== -->
    <section id="calendar" class="tabpane" hidden>
      <div class="card">
        <div class="card-h">Economic Calendar — Daily (ForexFactory style)</div>
        <div class="card-c">
          <div class="row">
            <div class="col"><label>Date</label><input id="newsDate" type="date" class="inp"></div>
            <div class="col"><label>Impact</label>
              <select id="impact" class="sel"><option value="all">All</option><option value="low">Low</option><option value="medium">Medium</option><option value="high">High</option></select>
            </div>
            <div class="col" style="flex:1">
              <label>Currencies</label>
              <div id="ccyChips" class="row" style="gap:6px"></div>
            </div>
            <div class="col"><label>&nbsp;</label><button id="refreshNews" class="btn">Refresh</button></div>
          </div>
          <div id="calStatus" class="muted" style="margin-top:8px"></div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <div class="card-h">Events</div>
        <div class="card-c" style="overflow:auto">
          <table>
            <thead><tr><th>Time</th><th>Currency</th><th>Event</th><th>Impact</th><th class="right">Forecast</th><th class="right">Previous</th><th class="right">Actual</th></tr></thead>
            <tbody id="calendarBody"></tbody>
          </table>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <div class="card-h">AI Insight (prototype)</div>
        <div class="card-c" id="aiNews">(AI on) — Summarizes today and flags high‑impact clusters.</div>
      </div>
    </section>

    <!-- ================== JOURNAL ================== -->
    <section id="journal" class="tabpane" hidden>
      <div class="card">
        <div class="card-h">New Journal Entry</div>
        <div class="card-c grid g-2">
          <div>
            <label>Date</label><input id="jDate" type="date" class="inp">
            <div class="grid g-2" style="margin-top:12px">
              <div><label>P/L</label><input id="jPnl" type="number" class="inp" value="0"></div>
              <div><label>Risk : Reward</label><input id="jRR" type="number" step="0.1" class="inp" value="1.0"></div>
            </div>
            <div class="grid g-2" style="margin-top:12px">
              <div>
                <label>Direction</label>
                <select id="jDir" class="sel"><option value="long">Long</option><option value="short">Short</option></select>
              </div>
              <div>
                <label>Symbol</label>
                <select id="jSym" class="sel">
                  <option>NQ</option><option>ES</option><option>GOLD</option><option>EURUSD</option><option>GBPUSD</option><option>USDJPY</option>
                </select>
              </div>
            </div>
            <div style="margin-top:12px"><label>Reason / Notes</label><textarea id="jReason" rows="5" class="inp"></textarea></div>
          </div>
          <div>
            <label>Screenshot</label><input id="jImg" type="file" accept="image/*" class="inp">
            <img id="preview" alt="preview" style="display:none; margin-top:8px; max-width:100%; border:1px solid var(--border); border-radius:12px" />
            <button id="saveEntry" class="btn primary" style="margin-top:12px">Save Entry</button>
            <div class="card" style="margin-top:12px"><div class="card-h">AI Insight (prototype)</div><div class="card-c" id="aiEntry">Add details to get feedback.</div></div>
          </div>
        </div>
      </div>

      <div class="grid g-3" style="margin-top:12px">
        <div class="card"><div class="card-h">Performance Overview</div><div class="card-c">
          <ul class="muted" id="perf"></ul>
          <canvas id="pnlChart" height="120" style="margin-top:8px"></canvas>
        </div></div>
        <div class="card" style="grid-column: span 2"><div class="card-h">Journal Entries</div><div class="card-c" id="entries"></div></div>
      </div>
    </section>

    <!-- ================== EXTRAS ================== -->
    <section id="extras" class="tabpane" hidden>
      <div class="grid g-3">
        <div class="card"><div class="card-h">Indicators</div><div class="card-c">
          <p class="muted">List your indicators here.</p>
          <div class="row"><input id="indInput" class="inp" placeholder="indicator link or id"><button id="addInd" class="btn">Add</button></div>
          <ul id="indList" class="muted"></ul>
        </div></div>
        <div class="card"><div class="card-h">Settings</div><div class="card-c">
          <label>Default Timezone</label><input id="setTz" class="inp" />
          <label style="margin-top:12px">Theme</label>
          <select id="theme" class="sel"><option value="system">System</option><option value="dark" selected>Dark</option><option value="light">Light</option></select>
        </div></div>
        <div class="card"><div class="card-h">Subscription</div><div class="card-c">
          <p class="muted">Manage your billing plan (placeholder).</p>
          <div class="row"><button class="btn">Change Plan</button><button class="btn primary">Manage Billing</button></div>
        </div></div>
      </div>
    </section>
  </main>

  <footer class="container" style="border-top:1px solid var(--border); padding:24px 0; color:var(--muted)">
    <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap">
      <small>© <span id="year"></span> TradePilot</small>
      <small><span class="badge">GitHub Pages single-file</span></small>
    </div>
  </footer>

  <!-- =============== Script =============== -->
  <script>
  // ---------- Tabs
  const $=(s,r=document)=>r.querySelector(s), $$=(s,r=document)=>Array.from(r.querySelectorAll(s));
  const panes=$$('.tabpane'); $$('.tab').forEach(b=>b.addEventListener('click',()=>{ $$('.tab').forEach(x=>x.classList.remove('active')); b.classList.add('active'); panes.forEach(p=>p.hidden = p.id!==b.dataset.tab); }));

  // ---------- Utilities
  const todayStr=()=>new Date().toISOString().slice(0,10);
  const dpr=window.devicePixelRatio||1;
  function drawBars(c,data){const ctx=c.getContext('2d');const w=c.clientWidth||300,h=c.clientHeight||120;c.width=w*dpr;c.height=h*dpr;ctx.scale(dpr,dpr);ctx.clearRect(0,0,w,h);const max=Math.max(...data,1);const bw=Math.max(1,w/data.length);ctx.fillStyle='#93c5fd';for(let i=0;i<data.length;i++){const x=i*bw,y=h*(1-data[i]/max);ctx.fillRect(x,y,Math.max(1,bw-1),h-y);}}

  // ---------- Strategies list (mainstream)
  const strategies=[
    { id:'fvg-ict', name:'Fair Value Gap (ICT)', tf:'M5', rr:2, desc:'Displacement + FVG retrace in session killzones.' },
    { id:'ob-ict', name:'Order Block (ICT)', tf:'M15', rr:2, desc:'Break of structure then mitigate OB.' },
    { id:'bos-choch', name:'Break of Structure / CHoCH', tf:'M5', rr:1.8, desc:'Trend reversal confirmation via CHoCH.' },
    { id:'orb', name:'Opening Range Breakout', tf:'M5', rr:1.5, desc:'Break of first N-min range (e.g., 15m).' },
    { id:'pullback', name:'Pullback Trend Continuation', tf:'M15', rr:1.6, desc:'EMA/VWAP pullback in trend.' },
    { id:'break-retest', name:'Break & Retest', tf:'H1', rr:1.5, desc:'Level breaks then retest/flip.' },
    { id:'supply-demand', name:'Supply & Demand', tf:'M30', rr:1.7, desc:'Imbalance zones drive turns.' },
    { id:'sma-cross', name:'SMA Crossover', tf:'H1', rr:1.2, desc:'Signal on MA cross.' },
    { id:'ema-cross', name:'EMA Crossover', tf:'M30', rr:1.3, desc:'Faster trend-following cross.' },
    { id:'macd', name:'MACD Cross', tf:'H1', rr:1.2, desc:'Momentum cross filter.' },
    { id:'rsi-div', name:'RSI Divergence', tf:'H1', rr:1.4, desc:'Price vs RSI divergence.' },
    { id:'bbands', name:'Bollinger Mean Reversion', tf:'M15', rr:1.1, desc:'Touch bands; revert to mean.' },
    { id:'ichimoku', name:'Ichimoku Trend', tf:'H1', rr:1.6, desc:'Cloud trend continuation.' },
    { id:'wyckoff', name:'Wyckoff (SPR/UTAD)', tf:'H1', rr:2.0, desc:'Accumulation/distribution play.' },
    { id:'turtle', name:'Turtle Breakout', tf:'D1', rr:1.5, desc:'Donchian channel breakouts.' },
    { id:'ict-silver-bullet', name:'Silver Bullet (ICT)', tf:'M5', rr:2, desc:'NY 10:00–11:00 displacement + retrace.' },
    { id:'ict-venom', name:'Venom (ICT)', tf:'M15', rr:1.8, desc:'News-aware sweep + FVG in London/NY.' }
  ];
  const stratSel=$('#strat'); strategies.forEach(s=>{const o=document.createElement('option'); o.value=s.id; o.textContent=s.name; stratSel.appendChild(o);});
  const symSel=$('#sym'); const fromInp=$('#from'); const toInp=$('#to'); const tradesInp=$('#trades'); const riskInp=$('#risk');
  toInp.value=todayStr();

  // Strategy visual (inline SVG)
  const svg=$('#stratSvg'); const stratName=$('#stratName'); const stratDesc=$('#stratDesc');
  function drawStrat(){
    const cur=strategies.find(s=>s.id===stratSel.value)||strategies[0]; stratName.textContent=cur.name; stratDesc.textContent=cur.desc||'';
    svg.innerHTML='';
    const NS='http://www.w3.org/2000/svg';
    const rect=document.createElementNS(NS,'rect'); rect.setAttribute('x','0'); rect.setAttribute('y','0'); rect.setAttribute('width','600'); rect.setAttribute('height','260'); rect.setAttribute('fill','#0b1220'); svg.appendChild(rect);
    const poly=document.createElementNS(NS,'polyline'); poly.setAttribute('fill','none'); poly.setAttribute('stroke','#6aa6ff'); poly.setAttribute('stroke-width','3'); poly.setAttribute('points','0,160 40,150 80,140 120,120 160,140 200,90 240,100 280,70 320,80 360,60 400,80 440,70 480,90'); svg.appendChild(poly);
    const fvg=document.createElementNS(NS,'rect'); fvg.setAttribute('x','240'); fvg.setAttribute('y','60'); fvg.setAttribute('width','40'); fvg.setAttribute('height','20'); fvg.setAttribute('fill','#10b981'); fvg.setAttribute('opacity','0.3'); svg.appendChild(fvg);
    const ob=document.createElementNS(NS,'rect'); ob.setAttribute('x','200'); ob.setAttribute('y','110'); ob.setAttribute('width','30'); ob.setAttribute('height','15'); ob.setAttribute('fill','#ef4444'); ob.setAttribute('opacity','0.3'); svg.appendChild(ob);
    const label=document.createElementNS(NS,'text'); label.setAttribute('x','12'); label.setAttribute('y','24'); label.setAttribute('fill','#cbd5e1'); label.setAttribute('font-size','14'); label.textContent=cur.name; svg.appendChild(label);
  }
  stratSel.addEventListener('change', drawStrat); drawStrat();

  // Quick ranges
  $$('#stats [data-range]').forEach(btn=>btn.addEventListener('click',()=>{
    const r=btn.getAttribute('data-range'); const end=new Date(); let start=new Date(end);
    if(r==='1m') start.setMonth(start.getMonth()-1); else if(r==='3m') start.setMonth(start.getMonth()-3); else if(r==='6m') start.setMonth(start.getMonth()-6); else if(r==='1y') start.setFullYear(start.getFullYear()-1); else if(r==='all') start=new Date('2015-01-01');
    fromInp.value=start.toISOString().slice(0,10); toInp.value=end.toISOString().slice(0,10);
  }));

  // Mock backtest
  function mulberry32(a){return function(){let t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return((t^t>>>14)>>>0)/4294967296}}
  function mockBacktest(id,tf,from,to,n,sym){const seed=(id+tf+from+to+n+sym).split('').reduce((a,c)=>a+c.charCodeAt(0),0);const rng=mulberry32(seed);const winRate=Math.round(45+rng()*30);const expectancy=(rng()*1.4-0.2);let eq=0;const equity=[];const len=Math.min(n,300);for(let i=0;i<len;i++){eq+=expectancy+(rng()-0.5);equity.push(Math.max(0,eq));}return{winRate,expectancy,equity}};
  function runStats(){ const cur=strategies.find(s=>s.id===stratSel.value)||strategies[0]; const r=mockBacktest(stratSel.value, cur.tf, fromInp.value, toInp.value, +tradesInp.value, symSel.value); $('#winrate').textContent=r.winRate+'%'; $('#expect').textContent=r.expectancy.toFixed(2)+' R'; drawBars($('#eq'), r.equity); }
  $('#run').addEventListener('click', runStats); runStats();

  // ---------- Calendar / News
  const currencies=['USD','EUR','GBP','JPY','CAD','AUD','NZD','CHF'];
  const ccyState=Object.fromEntries(currencies.map(c=>[c, ['USD','EUR','GBP'].includes(c)]));
  const chips=$('#ccyChips'); currencies.forEach(c=>{ const b=document.createElement('button'); b.className='btn'; b.textContent=c; b.style.width='auto'; b.style.padding='6px 10px';
    function setActive(){ b.style.background = ccyState[c] ? 'linear-gradient(135deg, var(--primary), var(--primary-2))' : 'var(--bg2)'; b.style.color = ccyState[c] ? '#fff' : 'var(--text)'; }
    setActive(); b.addEventListener('click',()=>{ ccyState[c]=!ccyState[c]; setActive(); renderNews();}); chips.appendChild(b); });

  const newsDate=$('#newsDate'); const impactSel=$('#impact'); const calBody=$('#calendarBody'); const calStatus=$('#calStatus'); const aiNews=$('#aiNews'); newsDate.value=todayStr();

  function mockNews(date, impact='all'){
    const base=[
      { time:'08:30', ccy:'USD', title:'Non-Farm Payrolls', impact:'high', forecast:'+170k', previous:'+187k', actual:'—', summary:'US jobs growth & wage pressure; large surprise can move USD and indices.' },
      { time:'07:00', ccy:'GBP', title:'BoE Gov Speech', impact:'medium', forecast:null, previous:null, actual:null, summary:'Speech hints at policy path and inflation stance.' },
      { time:'10:00', ccy:'EUR', title:'CPI (YoY)', impact:'high', forecast:'2.8%', previous:'3.1%', actual:'—', summary:'Eurozone inflation trend; deviation can reprice ECB path.' },
      { time:'13:30', ccy:'CAD', title:'Unemployment Rate', impact:'medium', forecast:'5.7%', previous:'5.6%', actual:'—', summary:'Labor market tightness; CAD sensitive to surprises.' },
      { time:'23:50', ccy:'JPY', title:'GDP (QoQ)', impact:'low', forecast:'0.2%', previous:'0.1%', actual:'—', summary:'Growth pulse; yen reacts on large surprises.' },
    ];
    const f = impact==='all'? base : base.filter(b=>b.impact===impact); return f;
  }

  function renderNews(){
    const list=mockNews(newsDate.value, impactSel.value).filter(it=> ccyState[it.ccy]);
    calBody.innerHTML='';
    list.forEach((it,i)=>{
      const tr=document.createElement('tr'); tr.className='hover'; tr.style.cursor='pointer';
      tr.innerHTML=`<td class="py-2">${it.time}</td><td>${it.ccy}</td><td>${it.title}</td><td class="capitalize"><span class="dot ${it.impact}" style="display:inline-block;vertical-align:middle"></span> ${it.impact}</td><td class="right">${it.forecast??'—'}</td><td class="right">${it.previous??'—'}</td><td class="right">${it.actual??'—'}</td>`;
      tr.addEventListener('click',()=> openEvent(it)); calBody.appendChild(tr);
    });
    const high=list.filter(x=>x.impact==='high'); aiNews.textContent = high.length? `High‑impact clusters today: ${[...new Set(high.map(h=>h.ccy))].join(', ')}` : 'Light to medium impact day.';
    calStatus.textContent = list.length? `Showing ${list.length} events for ${newsDate.value}.` : 'No events for current filters.';
  }
  $('#refreshNews').addEventListener('click', renderNews); impactSel.addEventListener('change', renderNews); renderNews();

  // Modal for event summary + impact bar
  function openEvent(ev){
    const wrap=document.createElement('div'); wrap.style.cssText='position:fixed;inset:0;background:rgba(0,0,0,.6);display:grid;place-items:center;z-index:1000;padding:16px';
    const box=document.createElement('div'); box.style.cssText='width:100%;max-width:640px;border:1px solid var(--border);background:var(--card);border-radius:12px;overflow:hidden';
    box.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border);padding:12px 16px"><div style="font-weight:700">${ev.ccy} — ${ev.title}</div><button id="x" class="btn" style="width:auto">✕</button></div>
      <div style="padding:16px" class="muted">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px"><span class="dot ${ev.impact}"></span><span class="capitalize">${ev.impact}</span></div>
        <div style="height:8px;border-radius:6px;background:#0f172a;overflow:hidden;margin:8px 0 12px 0"><div style="height:100%;width:${ev.impact==='high'?'100%':ev.impact==='medium'?'66%':'33%'};background:${ev.impact==='high'?'#f87171':ev.impact==='medium'?'#fbbf24':'#60a5fa'}"></div></div>
        <p style="color:#d1d5db">${ev.summary||'Brief summary.'}</p>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;font-size:12px;margin-top:10px">
          <div><span class="muted">Time:</span> ${ev.time}</div>
          <div><span class="muted">Forecast:</span> ${ev.forecast??'—'}</div>
          <div><span class="muted">Previous:</span> ${ev.previous??'—'}</div>
        </div>
      </div>`;
    wrap.appendChild(box); document.body.appendChild(wrap); $('#x', box).addEventListener('click', ()=>wrap.remove()); wrap.addEventListener('click', e=>{ if(e.target===wrap) wrap.remove(); });
  }

  // ---------- Journal (localStorage)
  const jDate=$('#jDate'); jDate.value=todayStr();
  const jPnl=$('#jPnl'), jRR=$('#jRR'), jReason=$('#jReason'), jImg=$('#jImg'), preview=$('#preview'), jDir=$('#jDir'), jSym=$('#jSym');
  const store={get(){try{return JSON.parse(localStorage.getItem('journal.entries')||'[]')}catch(e){return[]}}, set(v){localStorage.setItem('journal.entries', JSON.stringify(v))}};
  let entries=store.get();
  jImg?.addEventListener('change',()=>{const f=jImg.files?.[0]; if(!f){preview.style.display='none'; preview.src=''; return;} const url=URL.createObjectURL(f); preview.src=url; preview.style.display='block';});
  function aiEntryInsight(p, rr, reason){const tips=[]; if(+rr<1) tips.push('Consider improving R:R or using partials.'); if(+p<0) tips.push('Loss day — review entry/stop and news conflicts.'); if(!reason||reason.length<15) tips.push('Add more detail to your reason.'); if(!tips.length) tips.push('Solid trade. Keep journaling.'); return tips.join(' ');}  
  function summarize(list){const c=list.length;const wins=list.filter(e=>e.pnl>0).length;const losses=list.filter(e=>e.pnl<=0).length;const wr=c?Math.round(100*wins/c):0;const avg=c?list.reduce((a,b)=>a+b.pnl,0)/c:0;const m=new Map();list.forEach(e=>m.set(e.date,(m.get(e.date)||0)+e.pnl));const byDay=[...m.entries()].map(([date,pnl])=>({date,pnl}));const best=byDay.slice().sort((a,b)=>b.pnl-a.pnl)[0];const longPct=c?Math.round(100*list.filter(e=>e.dir==='long').length/c):0;const shortPct=c?Math.round(100*list.filter(e=>e.dir==='short').length/c):0;const biggestWin=c?Math.max(...list.map(e=>e.pnl)):0;const biggestLoss=c?Math.min(...list.map(e=>e.pnl)):0;return{c,wr,avg,byDay,best,longPct,shortPct,biggestWin,biggestLoss}}  
  function drawPnlChart(c,pts){const ctx=c.getContext('2d');const w=c.clientWidth||300,h=c.clientHeight||120;c.width=w*dpr;c.height=h*dpr;ctx.scale(dpr,dpr);ctx.clearRect(0,0,w,h);const max=Math.max(...pts.map(p=>Math.abs(p.pnl)),1);const bw=Math.max(4,w/Math.max(pts.length,1));pts.forEach((p,i)=>{const x=i*bw,y=h/2,mag=(Math.abs(p.pnl)/max)*(h/2-8);ctx.fillStyle=p.pnl>=0?'#34d399':'#f87171';ctx.fillRect(x,p.pnl>=0?y-mag:y,bw-2,mag);});}
  function renderEntries(){ const entriesDiv=$('#entries'); const perfUl=$('#perf'); entriesDiv.innerHTML= entries.map(e=>`<div class="card" style="margin-bottom:10px"><div class="card-c"><div class="grid g-2" style="align-items:center"><div>${e.image? `<img src="${e.image}" style="max-width:100%; border:1px solid var(--border); border-radius:12px"/>`:`<div class='muted' style='height:100px; display:flex; align-items:center; justify-content:center; border:1px dashed var(--border); border-radius:12px'>No image</div>`}</div><div><div><span class='badge'>Date</span> ${e.date}</div><div><span class='badge'>P/L</span> <span class='${e.pnl>=0? 'green':'red'}'>${e.pnl}</span></div><div><span class='badge'>R:R</span> ${e.rr}</div><div><span class='badge'>Direction</span> ${e.dir}</div><div><span class='badge'>Symbol</span> ${e.sym}</div><div><span class='badge'>Reason</span> ${e.reason? e.reason.replace(/</g,'&lt;'):''}</div></div></div></div></div>`).join(''); const s=summarize(entries); if(perfUl){perfUl.innerHTML=`<li>Total Trades: ${s.c}</li><li>Win Rate: ${s.wr}%</li><li>Wins: ${entries.filter(e=>e.pnl>0).length} • Losses: ${entries.filter(e=>e.pnl<=0).length}</li><li>Avg P/L: ${s.avg.toFixed(2)}</li><li>Biggest Win: ${s.biggestWin} • Biggest Loss: ${s.biggestLoss}</li><li>Long %: ${s.longPct}% • Short %: ${s.shortPct}%</li>`;} const pnlC=document.getElementById('pnlChart'); if(pnlC) drawPnlChart(pnlC, s.byDay); }
  document.getElementById('saveEntry')?.addEventListener('click', async()=>{const id=crypto.randomUUID(); let imgData=''; if(jImg?.files && jImg.files[0]){imgData=await new Promise(res=>{const r=new FileReader(); r.onload=()=>res(r.result); r.readAsDataURL(jImg.files[0]);});} const entry={id,date:jDate.value,pnl:Number(jPnl.value||0),rr:Number(jRR.value||0),reason:jReason.value,image:imgData,dir:jDir.value,sym:jSym.value}; entries=[entry,...entries]; store.set(entries); document.getElementById('aiEntry').textContent=aiEntryInsight(entry.pnl,entry.rr,entry.reason); jReason.value=''; jPnl.value=0; jRR.value=1.0; if(jImg) jImg.value=''; if(preview){preview.style.display='none'; preview.src='';} renderEntries(); });
  renderEntries();

  // ---------- Extras minimal
  const indInput=$('#indInput'), indList=$('#indList'); $('#addInd')?.addEventListener('click',()=>{ if(!indInput.value.trim()) return; const li=document.createElement('li'); li.textContent=indInput.value.trim(); indList.appendChild(li); indInput.value=''; });

  // ---------- Footer year
  document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
